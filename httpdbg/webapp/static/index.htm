<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>httpdbg</title>

    <link rel="shortcut icon" href="static/favicon.ico">

    <link rel="stylesheet" href="static/style.css">
    <link rel="stylesheet" href="static/table.css">
    <link rel="stylesheet" href="static/column.css">
    <link rel="stylesheet" href="static/detail.css">
    <link rel="stylesheet" href="static/tooltip.css">
    <style type="text/css" id="filter"></style>
    <style type="text/css" id="configurationcss"></style>
    <style type="text/css" id="serverstatuscss"></style>
    <script src="static/mustache.min.js"></script>
    <script src="static/main.js"></script>
    <script src="static/api.js"></script>
    <script src="static/render.js"></script>
    <script src="static/filter.js"></script>
    <script src="static/configuration.js"></script>
</head>

<body>
    <header>
        <nav id="navbar">
            httpdbg <button id="config" onclick="config()">&#9881;</button>
        </nav>
    </header>

    <div id="configuration">
        <h4>configuration</h4>

        <form id="configform" onsubmit="return false;">

            <input type="checkbox" id="cstatus" name="hs" onchange="load_config_from_form(true)">
            <label for="cstatus">Hide the status column</label>

            <br>

            <input type="checkbox" id="cmethod" name="hm" onchange="load_config_from_form(true)">
            <label for="cmethod">Hide the method column</label>

            <br>

            <input type="checkbox" id="curl" name="hn" onchange="load_config_from_form(true)">
            <label for="curl">Hide the netloc in the url</label>

            <br>

            <input type="checkbox" id="cinitiator" name="hi" onchange="load_config_from_form(true)">
            <label for="cinitiator">Hide the initiator column</label>

            <br>

            <input type="submit" value="OK" onclick="save_config_to_url(true)">

        </form>
        <br>
    </div>

    <div class="grid-container">

        <div class="grid-column grid-column-left">

            <table class="requests-table" id="requests-list">
                <colgroup>
                    <col span="1" class="status">
                    <col span="1" class="method">
                    <col span="1" class="url">
                    <col span="1" class="initiator">
                </colgroup>

                <thead>
                    <tr>
                        <th class="status" title="status"></th>
                        <th class="method" title="method"></th>
                        <th class="url">url
                            <span id="filter-url-btn" onclick="show_filter_url()">&#10729;</span>
                            <input type="text" value="" id="filter-url" onkeyup="update_filter_url()"
                                oncut="update_filter_url()" onpaste="update_filter_url()" onchange="update_filter_url()"
                                style="display: none;">
                        </th>
                        <th class="initiator" title="initiator">initiator</th>
                    </tr>
                </thead>

                <tbody>
                </tbody>

                <script id="template_request" type="x-tmpl-mustache">
                    <tr id="request-{{id}}"
                        data-filter-url="{{url}}"
                        onclick="show_request('{{id}}')"
                        class="request">
                        <td class="status"><span data-tooltip="{{reason}}" class="tooltip tooltip-status">{{{status_code_view}}}</span></td>
                        <td class="method"><span>{{verb}}</span></td>
                        <td class="url"><span title="{{url}}"><span class="netloc">{{netloc}}</span><span>{{urlext}}</span<></span></td>
                        <td class="initiator"><span title="{{initiator.long_label}}">{{initiator.short_label}}</span></td>
                    </tr>
                </script>
            </table>

        </div>

        <div class="grid-column">


            <div class="req-detail">

                <div class="tab">
                    <button id="btn-tab-headers" class="tablinks"
                        onclick="opentab(event.currentTarget, 'tabHeaders')">headers</button>
                    <button id="btn-tab-cookies" class="tablinks"
                        onclick="opentab(event.currentTarget, 'tabCookies')">cookies</button>
                    <button id="btn-tab-request" class="tablinks"
                        onclick="opentab(event.currentTarget, 'tabRequest')">request</button>
                    <button id="btn-tab-response" class="tablinks"
                        onclick="opentab(event.currentTarget, 'tabResponse')">response</button>
                    <button id="btn-tab-exception" class="tablinks"
                        onclick="opentab(event.currentTarget, 'tabException')">exception</button>
                    <button id="btn-tab-initiator" class="tablinks"
                        onclick="opentab(event.currentTarget, 'tabInitiator')">initiator</button>
                </div>


                <div id="tabHeaders" class="tabcontent">
                    <div id="headers">select a request to view details</div>
                    <script id="template_headers" type="x-tmpl-mustache">
                           <b>{{ method }}</b> <a href="{{ url }}">{{ url }}</a>
                           <hr>
                           <h4>status</h4>
                              {{ status_code }} {{ reason }}
                           <hr>
                           <h4>response headers</h4>
                           {{#response}}
                               {{#response.headers}}
                               <span class="header-cookie-key">{{name}}</span>:
                               <span class="header-cookie-value">{{value}}</span>
                               <br>
                               {{/response.headers}}
                           {{/response}}
                           <hr>
                           <h4>request headers</h4>
                           {{#request.headers}}
                           <span class="header-cookie-key">{{name}}</span>:
                           <span class="header-cookie-value">{{value}}</span>
                           <br>
                           {{/request.headers}}
                        </script>
                </div>

                <div id="tabCookies" class="tabcontent">
                    <div id="cookies">select a request to view details</div>
                    <script id="template_cookies" type="x-tmpl-mustache">
                           <h4>response cookies</h4>
                           {{#response}}
                               {{#response.cookies}}
                               <span class="header-cookie-key">{{name}}</span>: 
                               <span class="header-cookie-value">{{value}}</span> 
                                 <ul>
                                   {{#attributes}}
                                   <li>
                                    <span class="header-cookie-key">{{name}}</span>{{#attr}}: <span class="header-cookie-value">{{attr}}</span>{{/attr}}
                                   </li>
                                   {{/attributes}}
                                 </ul>
                               {{/response.cookies}}
                           {{/response}}
                           <hr>
                           <h4>request cookies</h4>
                           {{#request.cookies}}
                           <span class="header-cookie-key">{{name}}</span>: 
                           <span class="header-cookie-value">{{value}}</span>
                           <br> 
                           <br>
                           {{/request.cookies}}
                        </script>
                </div>

                <div id="tabRequest" class="tabcontent">
                    <div id="body_sent">select a request to view details</div>
                    <script id="template_body" type="x-tmpl-mustache">
                            {{^body}}
                            -- no content --
                            {{#stream}}
                            (because stream mode on)
                            {{/stream}}
                            {{/body}}

                            {{#body}}
                                {{#body.path}}
                                <a href="{{body.path}}" download="{{body.filename}}" class="need-server"><button>download</button></a>
                                <span class="need-server-info" title="Use the '-k' option to keep the server up and being able to download the content.">&#x1F6C8;</span>
                                {{/body.path}}

                                {{#body.text}}
                                
                                {{#body.raw_text}}
                                <button onclick="navigator.clipboard.writeText({{body.raw_text}});">copy to clipboard</button>
                                {{/body.raw_text}}

                                <label><input type="checkbox" onclick='show_wrap_lines(this.parentNode.parentNode.querySelector(".previewcode"));'>Wrap lines</label>
                                {{#body.parsed}}
                                    <label><input type="checkbox" onclick='show_raw_data(this.parentNode.parentNode.querySelector(".previewcode"), this.checked, {{body.raw_text}}, {{body.parsed_text}});'>Raw data</label>
                                    <pre class="previewcode">{{body.parsed}}</pre>
                                {{/body.parsed}}                                    
                                {{^body.parsed}}
                                    <pre class="previewcode">{{body.text}}</pre>
                                {{/body.parsed}}
                                
                                {{/body.text}}

                                {{#body.image}}
                                <br><br>
                                <img class="previewimage" src="{{body.path}}">
                                {{/body.image}}
                            {{/body}}
                        </script>
                </div>

                <div id="tabResponse" class="tabcontent">
                    <div id="body_received">select a request to view details</div>
                </div>
            </div>

            <div id="tabException" class="tabcontent">
                <div id="exception">select a request to view details</div>
                <script id="template_exception" type="x-tmpl-mustache">
                        {{^exception}}
                        -- no exception --
                        {{/exception}}
                        {{#exception}}
                            <span>{{exception.type}}</span>
                            <pre>{{exception.message}}</pre>
                        {{/exception}}
                    </script>
            </div>

            <div id="tabInitiator" class="tabcontent">
                <div id="initiator">select a request to view details</div>
                <script id="template_initiator" type="x-tmpl-mustache">
                        {{#initiator}}
                            <pre>{{initiator.stack}}</pre>
                        {{/initiator}}
                    </script>
            </div>

        </div>

    </div>


    <script>
        load_config_from_url(true);
        update_filter_url();
        pol_new_data();
        enable_refresh();
        opentab(document.getElementById("btn-tab-headers"), "tabHeaders");
    </script>
</body>

</html>